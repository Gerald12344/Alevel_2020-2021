{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\n// Written By Harvey Randall \\\\\nimport { useEffect, useState, useContext } from \"react\";\nimport * as THREE from 'three';\nimport CameraControls from 'camera-controls';\nimport { BoxGeometry, Clock, DoubleSide, Material, Mesh, MeshBasicMaterial, MeshStandardMaterial, PerspectiveCamera, PointLight, Scene, Vector3, WebGLRenderer, MeshLambertMaterial } from \"three\";\n\nvar perlin = require('perlin-noise');\n\nvar SimplexNoise = require('simplex-noise');\n\nimport { GenerateClouds } from '../components/clouds';\nimport { getRandomStarField } from '../components/stars';\nimport { CreateDayNightCycle } from \"../components/gameFundalmentals/DayNightCycle\";\n\nvar Stats = require('stats.js');\n\nimport { useAppContext } from '../components/contextHandler';\nimport { GenerateLabel } from '../components/nametag';\nCameraControls.install({\n  THREE: THREE\n});\nexport default function render() {\n  var _ref2;\n\n  var _useState = useState(undefined),\n      child = _useState[0],\n      setChild = _useState[1];\n\n  var _useState2 = useState(0),\n      newTheta = _useState2[0],\n      setTheat = _useState2[1];\n\n  var _useState3 = useState(\"not day\"),\n      day = _useState3[0],\n      setDay = _useState3[1];\n\n  var _useState4 = useState(undefined),\n      child2 = _useState4[0],\n      setChild2 = _useState4[1];\n\n  var _useState5 = useState(undefined),\n      pos = _useState5[0],\n      setPos = _useState5[1];\n\n  var _useState6 = useState(undefined),\n      rot = _useState6[0],\n      setRot = _useState6[1];\n\n  var socket = useAppContext();\n\n  var _useState7 = useState(undefined),\n      recievedSeed = _useState7[0],\n      setSeed = _useState7[1];\n\n  var _useState8 = useState(false),\n      rendered = _useState8[0],\n      setRendered = _useState8[1];\n\n  var _useState9 = useState([]),\n      clients = _useState9[0],\n      setClients = _useState9[1];\n\n  var _useState10 = useState(undefined),\n      personData = _useState10[0],\n      setPersonalData = _useState10[1];\n\n  var _useState11 = useState([]),\n      latestPerson = _useState11[0],\n      setLatestestPerson = _useState11[1];\n\n  var _useState12 = useState([]),\n      gameEventData = _useState12[0],\n      setgameEventData = _useState12[1];\n\n  socket.once(\"welcome\", function (seed, client, data) {\n    setSeed(seed);\n    console.log(client);\n    setClients(client);\n    setPersonalData(data);\n  });\n  useEffect(function () {\n    if (child === undefined || recievedSeed === undefined || rendered === true) return;\n    setRendered(true);\n    var stats = new Stats();\n    stats.showPanel(1); // 0: fps, 1: ms, 2: mb, 3+: custom\n\n    document.body.appendChild(stats.dom);\n    var SceneToGet = new Scene();\n    var Renders = new WebGLRenderer({\n      antialias: true,\n      alpha: true\n    });\n    Renders.setClearColor(0x87ceeb, 1);\n    Renders.setSize(window.innerWidth, window.innerHeight);\n    child.appendChild(Renders.domElement);\n    var simplex = new SimplexNoise(recievedSeed);\n    var clock = new Clock();\n    var planeGeometry = new THREE.PlaneGeometry(20, 20, 32, 32);\n    planeGeometry.rotateX(Math.PI / 2);\n    var planeMaterial = new THREE.MeshStandardMaterial({\n      color: 0x567d46,\n      side: DoubleSide\n    });\n    var plane = new THREE.Mesh(planeGeometry, planeMaterial);\n    plane.position.y = -0.5;\n    SceneToGet.add(plane);\n    var daynight = new CreateDayNightCycle(SceneToGet, Renders);\n    var geometry = new THREE.PlaneBufferGeometry(500, 500, 100, 100);\n    var colours = [];\n\n    for (var i = 0, l = geometry.attributes.position.count; i < l; i++) {\n      //console.log(geometry.attributes.position.array[(i*3)+2])\n      var x = geometry.attributes.position.array[i * 3] / 128;\n      var y = geometry.attributes.position.array[i * 3 + 1] / 128;\n      var height = simplex.noise2D(x, y) * 30;\n      geometry.attributes.position.array[i * 3 + 2] = height;\n\n      if (height > 23) {\n        colours.push(1, 1, 1);\n      } else if (height > 5) {\n        colours.push(0.56, 0.54, 0.48);\n      } else if (height < -20) {\n        colours.push(0.501, 0.772, 0.87);\n      } else {\n        colours.push(0.56, 0.68, 0.166);\n      }\n    }\n\n    var material = new THREE.MeshPhongMaterial({\n      vertexColors: THREE.VertexColors,\n      reflectivity: 0,\n      roughness: 2\n    });\n    material.flatShading = true;\n    var plane2 = new THREE.Mesh(geometry, material);\n    plane2.receiveShadow = true;\n    plane2.castShadow = true;\n    plane2.position.y = -3;\n    geometry.addAttribute('color', new THREE.BufferAttribute(new Float32Array(colours), 3));\n    geometry.computeVertexNormals();\n    var clouds = [];\n\n    for (var _i = 0; _i < 40; _i++) {\n      clouds.push(new GenerateClouds(new Vector3(Math.random() * 300 - 300, 80 + Math.random() * 20, Math.random() * 600 - 400), SceneToGet, Math.random() * 0.2, Math.random() * 6 + 1));\n    }\n\n    plane2.rotateX(Math.PI / 2 + Math.PI);\n    SceneToGet.add(plane2);\n    var Camera = new PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);\n    /*const cameraControls = new CameraControls(Camera, Renders.domElement);\n    cameraControls.azimuthRotateSpeed = -0.3; // negative value to invert rotation direction\n    cameraControls.polarRotateSpeed = -0.3; // negative value to invert rotation direction\n    cameraControls.truckSpeed = 1 / 1e-5 * 3;\n    cameraControls.distance = 5\n    //cameraControls.touches.two = CameraControls.ACTION.TOUCH_ZOOM_TRUCK;\n    cameraControls.saveState();*/\n    //Camera.position.z = 5;\n\n    var w = false,\n        a = false,\n        s = false,\n        d = false,\n        up = false,\n        down = false,\n        e = false,\n        q = false,\n        shift = 1;\n    document.addEventListener(\"keydown\", function (e) {\n      onDocumentKeyDown(e, true);\n    }, false);\n    document.addEventListener(\"keyup\", function (e) {\n      onDocumentKeyDown(e, false);\n    }, false);\n\n    function onDocumentKeyDown(event, val) {\n      var keyCode = event.which;\n\n      if (keyCode == 87) {\n        w = val;\n      }\n\n      if (keyCode == 83) {\n        s = val;\n      }\n\n      if (keyCode == 65) {\n        a = val;\n      }\n\n      if (keyCode == 68) {\n        d = val;\n      }\n\n      if (keyCode == 38) {\n        up = val;\n      }\n\n      if (keyCode == 40) {\n        down = val;\n      }\n\n      if (keyCode == 69) {\n        e = val;\n      }\n\n      if (keyCode == 81) {\n        q = val;\n      }\n\n      if (keyCode == 16) {\n        shift = val ? 0.5 : 1;\n      }\n    }\n\n    ;\n    Renders.domElement.requestPointerLock();\n    var gridHelper = new THREE.GridHelper(50, 50);\n    gridHelper.position.y = -1;\n    SceneToGet.add(gridHelper);\n    var players = [];\n\n    function MakeCube(color, name) {\n      var group = new THREE.Group();\n      var geometry = new THREE.BoxGeometry(1, 1, 1);\n      var material = new THREE.MeshLambertMaterial({\n        color: new THREE.Color(color),\n        emissive: new THREE.Color(color)\n      });\n      var cube = new THREE.Mesh(geometry, material);\n      group.add(cube);\n      var cyclinder = new THREE.CylinderGeometry(0.3, 0.3, 0.6, 30);\n      var material2 = new THREE.MeshLambertMaterial({\n        color: 0x000000\n      });\n      var cylinderBuild = new THREE.Mesh(cyclinder, material2);\n      cylinderBuild.rotateX(Math.PI / 2 + Math.PI);\n      cylinderBuild.position.set(0, 0, -0.6);\n      group.add(cylinderBuild);\n      GenerateLabel(name, group);\n      SceneToGet.add(group);\n      group.name = name;\n      return group;\n    }\n\n    console.log(clients);\n\n    var addtoGameFeed = function addtoGameFeed(name, event) {\n      var outArrayToSender = [{\n        name: name,\n        event: event\n      }]; //delete outArray[10] \n      //delete outArray[11] \n\n      setgameEventData([{\n        name: name,\n        event: event\n      }]);\n      console.log(\"array below\");\n      console.log(outArrayToSender);\n      console.log(gameEventData);\n    };\n\n    clients.forEach(function (e) {\n      console.log(\"Adding PLayer \" + e);\n      var cube = MakeCube(e.color, e.name);\n      players[e] = cube;\n    });\n    socket.on('NewPlayer', function (id, data) {\n      console.log(data);\n      console.log(\"New PLyer \" + id);\n      var cube = MakeCube(data.color, data.name);\n      addtoGameFeed(data.name, \"Joined the game!\");\n      players[id] = cube;\n    });\n    socket.on('LostPLayer', function (id, how, data) {\n      console.log(\"lost PLyer \" + id);\n      var cube = players[id];\n      SceneToGet.remove(cube);\n      delete players[id];\n      console.log(data);\n      addtoGameFeed(data.name, how === true ? \"Was removed from the game for being ianctive\" : \"Left the game!\");\n    });\n    socket.on('PlayerLocationUpdate', function (id, pos, rot, data) {\n      var cube = players[id];\n\n      if (cube) {\n        cube.rotation.set(rot._x, rot._y, rot._z);\n        cube.position.set(pos.x, pos.y, pos.z);\n      } else {\n        var _cube = MakeCube(data.color, data.name);\n\n        players[id] = _cube;\n      }\n    });\n    setInterval(function () {\n      socket.emit('LocationUpdate', Camera.position, Camera.rotation);\n    }, 30);\n\n    var animate = function animate() {\n      stats.begin();\n      requestAnimationFrame(animate);\n      daynight.update();\n      clouds.forEach(function (e, i) {\n        e.update();\n      });\n\n      if (w) {\n        var direction = new THREE.Vector3();\n        Camera.getWorldDirection(direction);\n        Camera.position.add(direction.multiplyScalar(shift == 1 ? 1 : 0.25)); //Camera.position.z -= 0.1\n      }\n\n      if (s) {\n        var direction = new THREE.Vector3();\n        Camera.getWorldDirection(direction);\n        Camera.position.add(direction.multiplyScalar(-(shift == 1 ? 1 : 0.25)));\n      }\n\n      if (a) {\n        Camera.rotateY(0.04 * shift);\n      }\n\n      if (d) {\n        Camera.rotateY(-0.04 * shift);\n      }\n\n      if (up) {\n        Camera.rotateX(0.04 * shift);\n      }\n\n      if (down) {\n        Camera.rotateX(-0.04 * shift);\n      }\n\n      if (q) {\n        Camera.rotateZ(0.02 * shift);\n      }\n\n      if (e) {\n        Camera.rotateZ(-0.02 * shift);\n      }\n\n      Renders.render(SceneToGet, Camera);\n      stats.end();\n    };\n\n    function listChildren(children) {\n      var child;\n\n      for (var _i2 = 0; _i2 < children.length; _i2++) {\n        child = children[_i2]; // Calls this function again if the child has children\n\n        if (child.children) {\n          listChildren(child.children);\n        } // Logs if this child last in recursion\n        else {\n            console.log('Reached bottom with: ', child);\n          }\n      }\n    }\n\n    listChildren(SceneToGet.children);\n    animate();\n  }, [child, clients]);\n  return /*#__PURE__*/_jsxs(\"main\", {\n    children: [/*#__PURE__*/_jsx(\"h1\", {\n      style: {\n        position: \"fixed\",\n        marginTop: \"40px\",\n        color: \"white\"\n      },\n      children: personData === undefined ? \"LOADING...\" : personData.name\n    }), /*#__PURE__*/_jsx(\"div\", {\n      style: {\n        width: \"100vw\",\n        height: \"100vh\",\n        position: \"fixed\",\n        marginTop: \"80px\"\n      },\n      children: latestPerson !== undefined && latestPerson.length > 0 ? latestPerson.map(function (e) {\n        if (e === undefined) return;\n\n        /*#__PURE__*/\n        _jsxs(\"h3\", {\n          style: {\n            color: \"white\"\n          },\n          children: [e.name, \" - \", e.event]\n        });\n      }) : /*#__PURE__*/_jsx(_Fragment, {\n        children: \"/\"\n      })\n    }), /*#__PURE__*/_jsx(\"div\", {\n      ref: function ref(_ref) {\n        return setChild2(_ref);\n      }\n    }), (_ref2 = recievedSeed === undefined) !== null && _ref2 !== void 0 ? _ref2 : /*#__PURE__*/_jsx(\"h1\", {\n      children: \"LOADING SEED!\"\n    }), /*#__PURE__*/_jsx(\"div\", {\n      ref: function ref(_ref3) {\n        return setChild(_ref3);\n      }\n    })]\n  });\n}","map":null,"metadata":{},"sourceType":"module"}