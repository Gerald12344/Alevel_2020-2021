{"ast":null,"code":"import _classCallCheck from \"/Users/year12/Desktop/Harvey/alevel_2020-2021/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/year12/Desktop/Harvey/alevel_2020-2021/node_modules/@babel/runtime/helpers/esm/createClass\";\n// Written By Harvey Randall \\\\\nimport { BackSide, BoxGeometry, Color, MathUtils, Mesh, MeshBasicMaterial, MeshLambertMaterial, SphereBufferGeometry, Vector3 } from \"three\";\nimport { createAmbientLight, createDirectionalLight } from \"../Core-API/LightingManager\";\nimport { getRandomStarField } from \"./stars\";\nimport { rotateAboutPoint } from \"./rotateAroundPoint\";\nimport { v4 } from \"uuid\";\nvar recieveDaytimeUpdate = {};\nvar day = true;\nexport function addtoDayTimeChecker(arg) {\n  var UUID = v4();\n  recieveDaytimeUpdate[UUID] = arg;\n  return UUID;\n}\nexport function removeFromDayTimeHook(UUID) {\n  delete recieveDaytimeUpdate[UUID];\n}\nexport function getDayState() {\n  return day;\n}\nexport var CreateDayNightCycle = /*#__PURE__*/function () {\n  function CreateDayNightCycle(SceneToGet, Renders) {\n    _classCallCheck(this, CreateDayNightCycle);\n\n    // ---------- [Two to level global variables] ---------- \\\\\n    this.SceneToGet = SceneToGet;\n    this.Renders = Renders;\n    this.announcedDay = false;\n    this.announcedNight = false; // ---------- [Create Sun Mesh] ---------- \\\\\n\n    var sun = new SphereBufferGeometry(20, 20, 100, 100);\n    var sunMaterial = new MeshLambertMaterial({\n      emissive: \"#f9d71c\"\n    });\n    var sunmesh = new Mesh(sun, sunMaterial);\n    sunmesh.position.set(1, 300, 300);\n    SceneToGet.add(sunmesh); // ---------- [Create Moon Mesh] ---------- \\\\\n\n    var moon = new SphereBufferGeometry(10, 10, 100, 100);\n    var moonMaterial = new MeshLambertMaterial({\n      emissive: \"#ffffff\"\n    });\n    var moonMesh = new Mesh(moon, moonMaterial);\n    moonMesh.position.set(-1, -200, -300);\n    SceneToGet.add(moonMesh); // ---------- [Create Box Gometry for handling rotation] ---------- \\\\\n\n    var geometry = new BoxGeometry(1, 1, 1);\n    var cube = new Mesh(geometry);\n    cube.visible = false;\n    SceneToGet.add(cube); // ^ This is a very bad work around fix later\n    // ---------- [All defintions for the moving part] ---------- \\\\\n\n    this.cube = cube;\n    this.moonMesh = moonMesh;\n    this.sunmesh = sunmesh;\n    this.t = 0;\n    this.dTIme = 0; // ---------- [All defintions for lights to create shadows] ---------- \\\\\n\n    this.directionalLight = createDirectionalLight(SceneToGet, \"#ddffee\", 0.5, [1, 100, 100]);\n    this.directionalLight2 = createDirectionalLight(SceneToGet, \"#ffffff\", 0.2, [1, -100, -100]);\n    this.light = createAmbientLight(SceneToGet, \"#aaaaaa\", 0.5); // ---------- [Create Stary night] ---------- \\\\\n\n    var skyBox = new BoxGeometry(1200, 1200, 1200);\n    var skyBoxMaterial = new MeshBasicMaterial({\n      map: getRandomStarField(600, 2048, 2048),\n      side: BackSide\n    });\n    this.sky = new Mesh(skyBox, skyBoxMaterial);\n  }\n  /*eslint complexity: [\"error\", 20]*/\n\n\n  _createClass(CreateDayNightCycle, [{\n    key: \"update\",\n    value: function update() {\n      // This two lines are  important as it is part of the hacky work around to get time of day on varying FPS\n      var theta = rotateAboutPoint(this.directionalLight, new Vector3(0, 0, 0), new Vector3(1, 0, 0), 0.001, true);\n      var angle = MathUtils.radToDeg(this.cube.rotation.x); // ---------- [Rotate all the lights and Meshes] ---------- \\\\\n\n      rotateAboutPoint(this.sunmesh, new Vector3(100, 0, 0), new Vector3(1, 0, 0), 0.001, true);\n      rotateAboutPoint(this.moonMesh, new Vector3(100, 0, 0), new Vector3(1, 0, 0), 0.001, true);\n      rotateAboutPoint(this.directionalLight2, new Vector3(0, 0, 0), new Vector3(1, 0, 0), 0.001, true); // ---------- [If it is day] ---------- \\\\\n\n      if (angle < 40 && this.dTIme < 1) {\n        day = true;\n        this.t = 0;\n        this.directionalLight.color = new Color(\"#ddffee\");\n        this.dTIme += 0.003;\n\n        if (this.dTIme >= 1) {\n          this.dTIme = 1;\n        }\n\n        this.Renders.setClearColor(new Color().lerpColors(new Color(\"#fdb813\"), new Color(\"#87ceeb\"), this.dTIme), 1);\n        this.light.intensity = 0.5;\n        this.directionalLight2.color = new Color(\"#000000\");\n        this.directionalLight.intensity = 0.5;\n        this.directionalLight2.intensity = 0;\n        this.SceneToGet.remove(this.sky);\n      } else if (!(angle < 40) && this.sky.parent !== this.SceneToGet) {\n        // ---------- [If it is night] ---------- \\\\\n        day = false;\n        this.dTIme = 0;\n        this.t += 0.01;\n\n        if (this.t >= 1) {\n          this.t = 1;\n          this.SceneToGet.add(this.sky);\n        }\n\n        this.directionalLight2.color = new Color(\"#ffffff\");\n        this.Renders.setClearColor(new Color().lerpColors(new Color(\"#87ceeb\"), new Color(\"#000000\"), this.t), 1);\n        this.light.intensity = 0.2;\n        this.directionalLight.intensity = 0;\n        this.directionalLight2.intensity = 0.2;\n      }\n\n      if (this.sky.parent === this.SceneToGet) {\n        this.sky.rotation.x -= 4 / 10000;\n      }\n\n      this.cube.rotateOnAxis(new Vector3(1, 0, 0), theta);\n    }\n  }]);\n\n  return CreateDayNightCycle;\n}();","map":null,"metadata":{},"sourceType":"module"}