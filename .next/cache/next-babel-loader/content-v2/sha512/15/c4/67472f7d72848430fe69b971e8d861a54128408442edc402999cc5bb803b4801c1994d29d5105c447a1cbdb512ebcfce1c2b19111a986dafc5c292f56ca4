{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport _toConsumableArray from \"/Users/year12/Desktop/Harvey/alevel_2020-2021/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\n\nvar _jsxFileName = \"/Users/year12/Desktop/Harvey/alevel_2020-2021/pages/test.js\",\n    _s = $RefreshSig$();\n\n// Written By Harvey Randall \\\\\nimport { useEffect, useState, useContext } from \"react\";\nimport * as THREE from 'three';\nimport CameraControls from 'camera-controls';\nimport { DoubleSide, PerspectiveCamera, Scene, Vector3, WebGLRenderer } from \"three\";\nimport { GenerateClouds } from '../components/gameFundalmentals/clouds';\nimport { CreateDayNightCycle } from \"../components/gameFundalmentals/DayNightCycle\";\n\nvar Stats = require('stats.js');\n\nimport { useAppContext } from '../components/Context/socketioContext';\nimport { GenerateLabel } from '../components/gameFundalmentals/nametag';\nimport { GenerateTerrain } from \"../components/gameFundalmentals/ProceduleTerrain\";\nimport { sendDataWithPromise, StartSeverClientCommunication, ListenToEvent } from \"../components/Core-API/ConnectAPI\";\nimport { ControlHandlerInit, ControlHandlerUpdate } from \"../components/gameFundalmentals/controls\";\nimport { addToRenderSequence, UpdateRenderCycle } from \"../components/Core-API/RenderingHandler\";\nCameraControls.install({\n  THREE: THREE\n});\nexport default function render() {\n  _s();\n\n  var _this = this,\n      _ref2;\n\n  var _useState = useState(undefined),\n      child = _useState[0],\n      setChild = _useState[1];\n\n  var _useState2 = useState([]),\n      gameEventData = _useState2[0],\n      setGameEventData = _useState2[1];\n\n  var _useState3 = useState(0),\n      newTheta = _useState3[0],\n      setTheat = _useState3[1];\n\n  var _useState4 = useState(\"not day\"),\n      day = _useState4[0],\n      setDay = _useState4[1];\n\n  var _useState5 = useState(undefined),\n      child2 = _useState5[0],\n      setChild2 = _useState5[1];\n\n  var _useState6 = useState(undefined),\n      pos = _useState6[0],\n      setPos = _useState6[1];\n\n  var _useState7 = useState(undefined),\n      rot = _useState7[0],\n      setRot = _useState7[1];\n\n  var socket = useAppContext();\n\n  var _useState8 = useState(undefined),\n      recievedSeed = _useState8[0],\n      setSeed = _useState8[1];\n\n  var _useState9 = useState(false),\n      rendered = _useState9[0],\n      setRendered = _useState9[1];\n\n  var _useState10 = useState([]),\n      clients = _useState10[0],\n      setClients = _useState10[1];\n\n  var _useState11 = useState(undefined),\n      personData = _useState11[0],\n      setPersonalData = _useState11[1];\n\n  var _useState12 = useState([]),\n      latestPerson = _useState12[0],\n      setLatestestPerson = _useState12[1];\n\n  StartSeverClientCommunication(socket);\n  socket.once(\"welcome\", function (seed, client, data) {\n    setSeed(seed);\n    console.log(client);\n    setClients(client);\n    setPersonalData(data);\n  });\n  useEffect(function () {\n    if (child === undefined || recievedSeed === undefined || rendered === true) return;\n    setRendered(true);\n    var stats = new Stats();\n    stats.showPanel(1); // 0: fps, 1: ms, 2: mb, 3+: custom\n\n    document.body.appendChild(stats.dom);\n    var SceneToGet = new Scene();\n    var Renders = new WebGLRenderer({\n      antialias: true,\n      alpha: true\n    });\n    Renders.setClearColor(0x87ceeb, 1);\n    Renders.setSize(window.innerWidth, window.innerHeight);\n    child.appendChild(Renders.domElement);\n    GenerateTerrain(recievedSeed, SceneToGet);\n    var planeGeometry = new THREE.PlaneGeometry(20, 20, 32, 32);\n    planeGeometry.rotateX(Math.PI / 2);\n    var planeMaterial = new THREE.MeshStandardMaterial({\n      color: 0x567d46,\n      side: DoubleSide\n    });\n    var plane = new THREE.Mesh(planeGeometry, planeMaterial);\n    plane.position.y = -0.5;\n    SceneToGet.add(plane);\n    var daynight = new CreateDayNightCycle(SceneToGet, Renders);\n    var clouds = [];\n\n    for (var i = 0; i < 40; i++) {\n      clouds.push(new GenerateClouds(new Vector3(Math.random() * 300 - 300, 80 + Math.random() * 20, Math.random() * 600 - 400), SceneToGet, Math.random() * 0.2, Math.random() * 6 + 1));\n    }\n\n    var Camera = new PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);\n    /*const cameraControls = new CameraControls(Camera, Renders.domElement);\n    cameraControls.azimuthRotateSpeed = -0.3; // negative value to invert rotation direction\n    cameraControls.polarRotateSpeed = -0.3; // negative value to invert rotation direction\n    cameraControls.truckSpeed = 1 / 1e-5 * 3;\n    cameraControls.distance = 5\n    //cameraControls.touches.two = CameraControls.ACTION.TOUCH_ZOOM_TRUCK;\n    cameraControls.saveState();*/\n    //Camera.position.z = 5;\n\n    Renders.domElement.requestPointerLock();\n    var gridHelper = new THREE.GridHelper(50, 50);\n    gridHelper.position.y = -1;\n    SceneToGet.add(gridHelper);\n    var players = [];\n\n    function MakeCube() {\n      var color = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : \"rgb(0,0,0)\";\n      var name = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : \"unkown\";\n      var group = new THREE.Group();\n      var geometry = new THREE.BoxGeometry(1, 1, 1);\n      var material = new THREE.MeshLambertMaterial({\n        color: new THREE.Color(color),\n        emissive: new THREE.Color(color)\n      });\n      var cube = new THREE.Mesh(geometry, material);\n      group.add(cube);\n      var cyclinder = new THREE.CylinderGeometry(0.3, 0.3, 0.6, 30);\n      var material2 = new THREE.MeshLambertMaterial({\n        color: 0x000000\n      });\n      var cylinderBuild = new THREE.Mesh(cyclinder, material2);\n      cylinderBuild.rotateX(Math.PI / 2 + Math.PI);\n      cylinderBuild.position.set(0, 0, -0.6);\n      group.add(cylinderBuild);\n      GenerateLabel(name, group);\n      SceneToGet.add(group);\n      group.name = name;\n      return group;\n    }\n\n    console.log(clients);\n    var prevData = [];\n\n    var addtoGameFeed = function addtoGameFeed() {\n      var name = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : \"Unkown\";\n      var event = arguments.length > 1 ? arguments[1] : undefined;\n\n      var NewGameEventArray = _toConsumableArray(prevData);\n\n      console.log(NewGameEventArray);\n      NewGameEventArray.unshift({\n        name: name,\n        event: event\n      });\n      delete NewGameEventArray[10];\n      delete NewGameEventArray[11];\n      setGameEventData(_toConsumableArray(NewGameEventArray));\n      console.log(\"array below\");\n      console.log(prevData);\n      prevData = NewGameEventArray;\n    };\n\n    clients.forEach(function (e) {\n      console.log(\"Adding PLayer \" + e);\n      var cube = MakeCube(e.color, e.name);\n      players[e] = cube;\n    });\n    socket.on('NewPlayer', function (id, data) {\n      console.log(data);\n      console.log(\"New PLyer \" + id);\n      var cube = MakeCube(data.color, data.name);\n      addtoGameFeed(data === null || data === void 0 ? void 0 : data.name, \"Joined the game!\");\n      players[id] = cube;\n    });\n    socket.on('LostPLayer', function (id, how, data) {\n      console.log(\"lost PLyer \" + id);\n      var cube = players[id];\n      SceneToGet.remove(cube);\n      delete players[id];\n      console.log(data);\n      addtoGameFeed(data === null || data === void 0 ? void 0 : data.name, how === true ? \"Was removed from the game for being inactive\" : \"Left the game!\");\n    });\n    ListenToEvent('PlayerLocationUpdate', function (id, pos, rot, data) {\n      var cube = players[id];\n\n      if (cube) {\n        cube.rotation.set(rot._x, rot._y, rot._z);\n        cube.position.set(pos.x, pos.y, pos.z);\n      } else {\n        var _cube = MakeCube(data === null || data === void 0 ? void 0 : data.color, data === null || data === void 0 ? void 0 : data.name);\n\n        players[id] = _cube;\n      }\n    });\n    socket.on(\"NewChat\", function (data, text) {\n      addtoGameFeed(data.name, text);\n    });\n    setInterval(function () {\n      socket.emit('LocationUpdate', Camera.position, Camera.rotation);\n    }, 10);\n    ControlHandlerInit(document, child2);\n    addToRenderSequence(function () {\n      clouds.forEach(function (e, i) {\n        e.update();\n      });\n    });\n    addToRenderSequence(function () {\n      return ControlHandlerUpdate(Camera);\n    });\n    addToRenderSequence(function () {\n      return daynight.update();\n    });\n\n    var animate = function animate() {\n      stats.begin();\n      requestAnimationFrame(animate); // Update all moving parts\n\n      UpdateRenderCycle();\n      Renders.render(SceneToGet, Camera);\n      stats.end();\n    };\n\n    function listChildren(children) {\n      var child;\n\n      for (var _i = 0; _i < children.length; _i++) {\n        child = children[_i]; // Calls this function again if the child has children\n\n        if (child.children) {\n          listChildren(child.children);\n        } // Logs if this child last in recursion\n        else {\n            console.log('Reached bottom with: ', child);\n          }\n      }\n    }\n\n    listChildren(SceneToGet.children);\n    animate();\n  }, [child, clients]);\n\n  var sendChat = function sendChat(e) {\n    e.preventDefault();\n    socket.emit(\"sendChat\", child2.value);\n    child2.value = \"\";\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"main\", {\n    children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n      style: {\n        position: \"fixed\",\n        marginTop: \"40px\",\n        color: \"white\"\n      },\n      children: personData === undefined ? \"LOADING...\" : personData.name\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 237,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        width: \"100vw\",\n        height: \"100vh\",\n        position: \"fixed\",\n        marginTop: \"80px\"\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"form\", {\n        onSubmit: sendChat,\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          ref: function ref(_ref) {\n            return setChild2(_ref);\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 240,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"Submit\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 241,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 239,\n        columnNumber: 17\n      }, this), _toConsumableArray(gameEventData).map(function (e) {\n        if (e == undefined) return;\n        return /*#__PURE__*/_jsxDEV(\"h4\", {\n          style: {\n            color: \"white\"\n          },\n          children: [e.name, \" - \", e.event]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 246,\n          columnNumber: 25\n        }, _this);\n      })]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 238,\n      columnNumber: 13\n    }, this), (_ref2 = recievedSeed === undefined) !== null && _ref2 !== void 0 ? _ref2 : /*#__PURE__*/_jsxDEV(\"h1\", {\n      children: \"LOADING SEED!\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 251,\n      columnNumber: 45\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      ref: function ref(_ref3) {\n        return setChild(_ref3);\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 252,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 236,\n    columnNumber: 9\n  }, this);\n}\n\n_s(render, \"+dY60sEykAkkmuHPt+1h019pv4I=\", false, function () {\n  return [useAppContext];\n});","map":{"version":3,"sources":["/Users/year12/Desktop/Harvey/alevel_2020-2021/pages/test.js"],"names":["useEffect","useState","useContext","THREE","CameraControls","DoubleSide","PerspectiveCamera","Scene","Vector3","WebGLRenderer","GenerateClouds","CreateDayNightCycle","Stats","require","useAppContext","GenerateLabel","GenerateTerrain","sendDataWithPromise","StartSeverClientCommunication","ListenToEvent","ControlHandlerInit","ControlHandlerUpdate","addToRenderSequence","UpdateRenderCycle","install","render","undefined","child","setChild","gameEventData","setGameEventData","newTheta","setTheat","day","setDay","child2","setChild2","pos","setPos","rot","setRot","socket","recievedSeed","setSeed","rendered","setRendered","clients","setClients","personData","setPersonalData","latestPerson","setLatestestPerson","once","seed","client","data","console","log","stats","showPanel","document","body","appendChild","dom","SceneToGet","Renders","antialias","alpha","setClearColor","setSize","window","innerWidth","innerHeight","domElement","planeGeometry","PlaneGeometry","rotateX","Math","PI","planeMaterial","MeshStandardMaterial","color","side","plane","Mesh","position","y","add","daynight","clouds","i","push","random","Camera","requestPointerLock","gridHelper","GridHelper","players","MakeCube","name","group","Group","geometry","BoxGeometry","material","MeshLambertMaterial","Color","emissive","cube","cyclinder","CylinderGeometry","material2","cylinderBuild","set","prevData","addtoGameFeed","event","NewGameEventArray","unshift","forEach","e","on","id","how","remove","rotation","_x","_y","_z","x","z","text","setInterval","emit","update","animate","begin","requestAnimationFrame","end","listChildren","children","length","sendChat","preventDefault","value","marginTop","width","height","ref","map"],"mappings":"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","sourcesContent":["// Written By Harvey Randall \\\\\n\nimport { useEffect, useState, useContext } from \"react\"\nimport * as THREE from 'three';\nimport CameraControls from 'camera-controls';\nimport { DoubleSide, PerspectiveCamera, Scene, Vector3, WebGLRenderer } from \"three\"\nimport { GenerateClouds } from '../components/gameFundalmentals/clouds'\nimport { CreateDayNightCycle } from \"../components/gameFundalmentals/DayNightCycle\";\nvar Stats = require('stats.js')\nimport { useAppContext } from '../components/Context/socketioContext'\nimport { GenerateLabel } from '../components/gameFundalmentals/nametag'\nimport { GenerateTerrain } from \"../components/gameFundalmentals/ProceduleTerrain\";\nimport { sendDataWithPromise, StartSeverClientCommunication, ListenToEvent } from \"../components/Core-API/ConnectAPI\";\nimport { ControlHandlerInit, ControlHandlerUpdate } from \"../components/gameFundalmentals/controls\";\nimport { addToRenderSequence, UpdateRenderCycle } from \"../components/Core-API/RenderingHandler\";\nCameraControls.install({ THREE: THREE });\n\n\nexport default function render() {\n    const [child, setChild] = useState(undefined)\n    const [gameEventData, setGameEventData] = useState([])\n\n    const [newTheta, setTheat] = useState(0)\n    const [day, setDay] = useState(\"not day\")\n    const [child2, setChild2] = useState(undefined)\n    const [pos, setPos] = useState(undefined)\n    const [rot, setRot] = useState(undefined)\n    const socket = useAppContext()\n    const [recievedSeed, setSeed] = useState(undefined)\n    const [rendered, setRendered] = useState(false)\n    const [clients, setClients] = useState([])\n    const [personData, setPersonalData] = useState(undefined)\n    const [latestPerson, setLatestestPerson] = useState([])\n\n    StartSeverClientCommunication(socket)\n\n\n    socket.once(\"welcome\", (seed, client, data) => {\n        setSeed(seed)\n        console.log(client)\n        setClients(client)\n        setPersonalData(data)\n    });\n\n    useEffect(() => {\n        if (child === undefined || recievedSeed === undefined || rendered === true) return;\n        setRendered(true)\n\n        let stats = new Stats();\n        stats.showPanel(1); // 0: fps, 1: ms, 2: mb, 3+: custom\n        document.body.appendChild(stats.dom);\n\n        let SceneToGet = new Scene()\n        let Renders = new WebGLRenderer({\n            antialias: true,\n            alpha: true\n        })\n\n        Renders.setClearColor(0x87ceeb, 1);\n\n\n        Renders.setSize(window.innerWidth, window.innerHeight)\n        child.appendChild(Renders.domElement);\n\n\n        GenerateTerrain(recievedSeed, SceneToGet)\n\n\n\n        const planeGeometry = new THREE.PlaneGeometry(20, 20, 32, 32);\n        planeGeometry.rotateX(Math.PI / 2)\n        const planeMaterial = new THREE.MeshStandardMaterial({ color: 0x567d46, side: DoubleSide })\n        const plane = new THREE.Mesh(planeGeometry, planeMaterial);\n        plane.position.y = -0.5\n        SceneToGet.add(plane);\n\n        let daynight = new CreateDayNightCycle(SceneToGet, Renders)\n\n\n        let clouds = []\n        for (let i = 0; i < 40; i++) {\n            clouds.push(new GenerateClouds(new Vector3((Math.random() * 300) - 300, 80 + Math.random() * 20, (Math.random() * 600) - 400), SceneToGet, Math.random() * 0.2, Math.random() * 6 + 1))\n        }\n        var Camera = new PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000)\n        /*const cameraControls = new CameraControls(Camera, Renders.domElement);\n        cameraControls.azimuthRotateSpeed = -0.3; // negative value to invert rotation direction\n        cameraControls.polarRotateSpeed = -0.3; // negative value to invert rotation direction\n        cameraControls.truckSpeed = 1 / 1e-5 * 3;\n        cameraControls.distance = 5\n        //cameraControls.touches.two = CameraControls.ACTION.TOUCH_ZOOM_TRUCK;\n        cameraControls.saveState();*/\n        //Camera.position.z = 5;\n\n\n\n\n\n        Renders.domElement.requestPointerLock()\n\n        const gridHelper = new THREE.GridHelper(50, 50);\n        gridHelper.position.y = -1;\n        SceneToGet.add(gridHelper);\n        let players = []\n\n        function MakeCube(color = \"rgb(0,0,0)\", name = \"unkown\") {\n            const group = new THREE.Group();\n            const geometry = new THREE.BoxGeometry(1, 1, 1);\n            const material = new THREE.MeshLambertMaterial({ color: new THREE.Color(color), emissive: new THREE.Color(color) });\n            const cube = new THREE.Mesh(geometry, material);\n            group.add(cube)\n            const cyclinder = new THREE.CylinderGeometry(0.3, 0.3, 0.6, 30);\n            const material2 = new THREE.MeshLambertMaterial({ color: 0x000000 });\n            const cylinderBuild = new THREE.Mesh(cyclinder, material2);\n            cylinderBuild.rotateX((Math.PI / 2) + Math.PI)\n            cylinderBuild.position.set(0, 0, -0.6)\n            group.add(cylinderBuild)\n\n            GenerateLabel(name, group)\n            SceneToGet.add(group)\n            group.name = name\n            return group\n        }\n\n        console.log(clients)\n        let prevData = []\n\n        let addtoGameFeed = (name = \"Unkown\", event) => {\n            let NewGameEventArray = [...prevData]\n            console.log(NewGameEventArray)\n            NewGameEventArray.unshift({ name: name, event: event })\n            delete NewGameEventArray[10]\n            delete NewGameEventArray[11]\n            setGameEventData([...NewGameEventArray])\n            console.log(\"array below\")\n            console.log(prevData)\n            prevData = NewGameEventArray\n        }\n\n        clients.forEach(e => {\n            console.log(\"Adding PLayer \" + e)\n            let cube = MakeCube(e.color, e.name)\n            players[e] = cube\n        })\n\n\n\n        socket.on('NewPlayer', (id, data) => {\n            console.log(data)\n            console.log(\"New PLyer \" + id)\n            let cube = MakeCube(data.color, data.name)\n            addtoGameFeed(data?.name, \"Joined the game!\")\n\n            players[id] = cube\n        })\n\n        socket.on('LostPLayer', (id, how, data) => {\n            console.log(\"lost PLyer \" + id)\n            let cube = players[id]\n            SceneToGet.remove(cube)\n            delete players[id]\n            console.log(data)\n            addtoGameFeed(data?.name, how === true ? \"Was removed from the game for being inactive\" : \"Left the game!\")\n        })\n\n        ListenToEvent('PlayerLocationUpdate', (id, pos, rot, data) => {\n            let cube = players[id]\n            if (cube) {\n                cube.rotation.set(rot._x, rot._y, rot._z)\n                cube.position.set(pos.x, pos.y, pos.z)\n            }\n            else {\n                let cube = MakeCube(data?.color, data?.name)\n\n                players[id] = cube\n\n            }\n\n        })\n        socket.on(\"NewChat\", (data, text) => {\n            addtoGameFeed(data.name, text)\n        })\n        setInterval(() => {\n            socket.emit('LocationUpdate', Camera.position, Camera.rotation)\n        }, 10)\n\n        ControlHandlerInit(document, child2)\n\n        addToRenderSequence(() => {\n            clouds.forEach((e, i) => {\n                e.update()\n            })\n        })\n\n        addToRenderSequence(() => ControlHandlerUpdate(Camera))\n        addToRenderSequence(() =>  daynight.update())\n\n\n        var animate = function () {\n            stats.begin()\n            requestAnimationFrame(animate)\n\n            // Update all moving parts\n            UpdateRenderCycle()\n\n            Renders.render(SceneToGet, Camera);\n            stats.end()\n        };\n\n        function listChildren(children) {\n            let child;\n            for (let i = 0; i < children.length; i++) {\n                child = children[i];\n\n                // Calls this function again if the child has children\n                if (child.children) {\n                    listChildren(child.children);\n                }\n                // Logs if this child last in recursion\n                else {\n                    console.log('Reached bottom with: ', child);\n                }\n            }\n        }\n\n        listChildren(SceneToGet.children);\n        animate();\n    }, [child, clients])\n\n    let sendChat = (e) => {\n        e.preventDefault()\n        socket.emit(\"sendChat\", child2.value)\n        child2.value = \"\"\n    }\n\n    return (\n        <main >\n            <h1 style={{ position: \"fixed\", marginTop: \"40px\", color: \"white\" }}>{personData === undefined ? \"LOADING...\" : personData.name}</h1>\n            <div style={{ width: \"100vw\", height: \"100vh\", position: \"fixed\", marginTop: \"80px\" }}>\n                <form onSubmit={sendChat}>\n                    <input ref={ref => (setChild2(ref))}></input>\n                    <input type=\"Submit\"></input>\n                </form>\n                {[...gameEventData].map((e) => {\n                    if (e == undefined) return;\n                    return (\n                        <h4 style={{ color: \"white\" }}>{e.name} - {e.event}</h4>\n                    )\n                })}\n\n            </div>\n            { recievedSeed === undefined ?? <h1>LOADING SEED!</h1>}\n            <div ref={ref => (setChild(ref))}></div>\n        </main>\n    )\n}\n"]},"metadata":{},"sourceType":"module"}